# 0031 - Auto-Delete API Key Message After 5 Minutes

## Description

When a new API key is created via the Telegram bot, the message containing the raw key (`hrk_...`) should be automatically deleted after 5 minutes. This gives the user enough time to copy the key while preventing it from lingering in the chat history indefinitely — improving security posture.

## Current Behavior

In `src/bot/handlers/settings_handler.py:api_key_name_entered()` (line 344), the raw key is sent via `reply_text()` and stays in the chat forever.

## Changes Required

### 1. `src/bot/handlers/settings_handler.py` — `api_key_name_entered()`

After sending the API key message (line 344), schedule its deletion:

- Capture the returned `Message` object from `reply_text()`
- Use `context.job_queue.run_once()` to schedule a job that deletes the message after **300 seconds** (5 minutes)
- The scheduled job callback should call `context.bot.delete_message(chat_id, message_id)`
- Wrap the deletion in a try/except to handle cases where the message was already deleted manually or the bot lost permissions

### 2. Message text update

Optionally update the `API_KEY_CREATED` message template (in the messages/translations file) to inform the user: the message will auto-delete in 5 minutes.

## Algorithm

1. User enters API key name → `api_key_name_entered()` is called
2. Key is created via `api_key_service.create_api_key()`
3. Raw key message is sent → store the returned `Message` object
4. `context.job_queue.run_once(delete_callback, when=300, data={"chat_id": msg.chat_id, "message_id": msg.message_id})`
5. After 5 minutes, `delete_callback` fires → `context.bot.delete_message(chat_id, message_id)`
6. If deletion fails (message already gone, permissions issue), log a warning and silently continue

## Unit Tests

**File:** `tests/bot/test_api_key_auto_delete.py`

| Scenario | Description |
|----------|-------------|
| Message deletion scheduled | After key creation, verify `job_queue.run_once` is called with `when=300` |
| Callback deletes message | Invoke the scheduled callback and verify `bot.delete_message` is called with correct `chat_id` and `message_id` |
| Deletion failure handled gracefully | Simulate `delete_message` raising an exception; verify no crash and warning is logged |
| Message still contains raw key | Verify the reply message still includes the raw key text for the user to copy |
