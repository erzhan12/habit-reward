# Feature 0030: Remove Reward Type Field

## Overview

This feature was implemented in two phases:
1. **Phase 1**: Default reward type to "Real" and hide it from creation flow
2. **Phase 2**: Completely remove the `type` field from the codebase

---

## Phase 1: Default to Real (Initial Implementation)

### Context
The reward creation flow should skip the "Category" step and default it to **Real**. The field should remain in storage and APIs, but it should not appear in any user-facing messages during reward creation.

### Plan
1. Update `reward_name_received()` to set `reward_data['type'] = RewardType.REAL` and skip to weight prompt
2. Remove type-selection state from `add_reward_conversation`
3. Update `_format_reward_summary()` to omit reward type from confirmation
4. Update `HELP_ADD_REWARD_CONFIRM` in all languages to remove Type line
5. Keep edit flow unchanged

### Files Modified (Phase 1)
- `src/bot/handlers/reward_handlers.py`
- `src/bot/messages.py`
- `tests/test_bot_handlers.py`

---

## Phase 2: Complete Removal (Final Implementation)

### Context
After Phase 1, the `type` field became effectively unused - all rewards defaulted to "Real" and the field was hidden from users. The decision was made to remove it entirely to simplify the codebase.

### Plan
1. Remove `RewardType` enum from Pydantic model (`src/models/reward.py`)
2. Remove `type` field from Django model (`src/core/models.py`)
3. Create migration to drop the column and its index
4. Update service layer to remove type parameter
5. Update bot handlers, keyboards, messages, formatters
6. Update API routers to remove type from request/response models
7. Update repository to remove type filters
8. Update all tests

### Files Modified (Phase 2)

**Core:**
- `src/models/reward.py` - Removed `RewardType` enum and `type` field
- `src/core/models.py` - Removed `RewardType` enum, `type` field, and index
- `src/core/admin.py` - Removed `type` from admin display
- `src/core/repositories.py` - Removed type filters and references
- `src/services/reward_service.py` - Removed type parameter

**Bot:**
- `src/bot/handlers/reward_handlers.py` - Removed type selection flows
- `src/bot/keyboards.py` - Removed type keyboard functions
- `src/bot/messages.py` - Removed type messages (en/ru/kk)
- `src/bot/formatters.py` - Simplified reward display

**API:**
- `src/api/v1/routers/rewards.py` - Removed type from models
- `src/api/v1/routers/habits.py` - Removed type from reward response

**Migration:**
- `src/core/migrations/0013_remove_reward_type_field.py`

**Tests (8 files):**
- `tests/test_reward_service.py`
- `tests/test_bot_handlers.py`
- `tests/test_backdate_habit.py`
- `tests/test_habit_service.py`
- `tests/test_admin_actions.py`
- `tests/test_audit_logs.py`
- `tests/api/test_rewards.py`
- `tests/api/conftest.py`

---

## Migration Notes

The migration `0013_remove_reward_type_field.py` removes:
1. Index `rewards_user_id_4de814_idx` (composite index on `['user', 'type']`)
2. Field `type` from Reward model

Note: The single-column `rewards_type_5c8906_idx` index was already removed in migration `0004_add_user_to_habits_rewards.py`.
